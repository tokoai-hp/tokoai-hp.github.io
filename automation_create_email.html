<script>
    // ... (previous code remains unchanged)

    copyButton.addEventListener('click', function() {
        const tempTextArea = document.createElement('textarea');
        tempTextArea.value = generatedPassword;
        document.body.appendChild(tempTextArea);
        
        tempTextArea.select();
        document.execCommand('copy');
        
        document.body.removeChild(tempTextArea);

        copyButton.textContent = '已复制';
        setTimeout(() => {
            copyButton.textContent = '复制';
        }, 2000);
    });

    // 用户认证和头像功能
    const loginItem = document.getElementById('loginItem');
    const userMenu = document.getElementById('userMenu');
    const userAvatar = document.getElementById('userAvatar');

    async function checkAuth() {
        const token = localStorage.getItem('authToken');
        if (token) {
            try {
                const response = await axios.get('https://x8ki-letl-twmt.n7.xano.io/api:3dq0iFXe/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                loginItem.classList.add('hidden');
                userMenu.classList.remove('hidden');
                userAvatar.textContent = response.data.name.charAt(0).toUpperCase();
                userAvatar.addEventListener('click', () => {
                    window.location.href = 'https://tokoai-hp.github.io';
                });
            } catch (error) {
                console.error('Authentication failed:', error);
                localStorage.removeItem('authToken');
                window.location.href = './login.html';
            }
        } else {
            window.location.href = './login.html';
        }
    }

    checkAuth();
});
</script>
</body>
</html>
